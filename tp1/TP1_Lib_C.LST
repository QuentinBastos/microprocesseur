C51 COMPILER V9.60.0.0   TP1_LIB_C                                                         02/09/2026 11:22:26 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TP1_LIB_C
OBJECT MODULE PLACED IN TP1_Lib_C.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE TP1_Lib_C.c OPTIMIZE(0,SPEED) REGFILE(.\TP1_3IRC_EXE.ORC) BROWSE DEBUG O
                    -BJECTEXTEND TABS(2)

line level    source

   1          /******************************************************************************
   2          ;   FILE NAME   : TP4_Lib_Config_Globale_8051F020.C
   3          ;   TARGET MCUs : C8051F020, 
   4          ;   DESCRIPTION : Configurations GLOBALES pour le 8051F020
   5          ;
   6          ;   REVISION 1.0
   7          ;   Ce fichier contient les codes de configuration globale du 8051F020
   8          ;     - Configuration de l'horloge système SYSCLK
   9          ;     - Configuration des broches du 80851F020
  10          ;     - Configuration Reset et watchdog
  11          */
  12          //******************************************************************************
  13          
  14          #include "C8051F020.h"
  15          #include "c8051F020_SFR16.h"
  16          #include "TP1_lib_C.h"
  17          
  18          // Peripheral specific initialization functions,
  19          // Called from the Init_Device() function
  20          
  21          //-----------------------------------------------------------------------------
  22          // Dévalidation du watchdog
  23          //-----------------------------------------------------------------------------
  24          void Reset_Sources_Init()
  25          {
  26   1        // La configuration des registres WDTCN  sera étudiée plus tard
  27   1         WDTCN = 0xDE;
  28   1         WDTCN = 0XAD;
  29   1         RSTSRC = 0;
  30   1      }
  31          //-----------------------------------------------------------------------------
  32          // configuration de l'horloge système
  33          //  Quartz externe à 22,1184 MHz
  34          //-----------------------------------------------------------------------------
  35          void Oscillator_Init()
  36          {
  37   1          int i = 0;
  38   1          OSCXCN    = 0x67;
  39   1          for (i = 0; i < 3000; i++);  // Wait 1ms for initialization
  40   1          while ((OSCXCN & 0x80) == 0);
  41   1          OSCICN    = 0x0C;
  42   1      }
  43          //-----------------------------------------------------------------------------
  44          // Configuration des Ports d'entrée-sorties
  45          //-----------------------------------------------------------------------------
  46          
  47          void Port_IO_Init()
  48          {
  49   1          // P0.0  -  Congiguration PIO - TX0 (UART0)
  50   1          // P0.1  -  Congiguration PIO - RX0 (UART0)
  51   1          // P0.2  -  Congiguration PIO - INT0 (Tmr0)
  52   1          // P0.3  -  Congiguration PIO - INT1 (Tmr1)
  53   1          // P0.4  -  Congiguration PIO - SYSCLK
  54   1          // P0.5 à P7.7  - Mode GPIO par défaut 
C51 COMPILER V9.60.0.0   TP1_LIB_C                                                         02/09/2026 11:22:26 PAGE 2   

  55   1       
  56   1      // La configuration des registres XBR
  57   1          XBR0      = 0x04; // UART0 routée sur P0.0 et P0.1
  58   1          XBR1      = 0x94; // INT0 routée sur P0.2, INT1 sur P0.3 et Sysclock routée sur P0.4
  59   1          XBR2      = 0x40; //  Crossbar validé
  60   1      
  61   1      // Port configuration (1 = Push Pull Output)
  62   1          P0MDOUT =0x11;    // Output configuration for P0 
  63   1          P1MDOUT = 0x40;   // Output configuration for P1  -- Drain ouvert sauf P1.6
  64   1          P2MDOUT = 0;   // Output configuration for P2  -- Drain ouvert
  65   1          P3MDOUT = 0;   // Output configuration for P3  -- Drain ouvert
  66   1          P74OUT = 0;    //  P4, P5, P6 et P7 configurés en drain ouvert
  67   1          P1MDIN = 0xFF;  // Pas d'entrée analogique sur P1
  68   1          P4 = 0xDF;       // ALE=0, /RD=1, /WR=1 en dehors des cycles mémoires
  69   1          P0 = (1<<2)|(1<<3); // Broche P0.2 - INT0 Configurée en entrée
  70   1                              // Broche P0.3 - INT1 Configurée en entrée
  71   1          P1 &= ~(1<<6);   // P1.6 mis à zéro
  72   1          P1MDOUT |= (1<<6);  // P1.6  configuré en Push Pull
  73   1      
  74   1        
  75   1      // La configuration qui suit n'a qu'un intêret pédagogique... 
  76   1           P3 = 0;
  77   1           P3MDOUT = 0xFF;
  78   1      // Fin de la config à intêret pédagogique
  79   1      }
  80          //-----------------------------------------------------------------------------
  81          // Configuration des 2 DAC
  82          //-----------------------------------------------------------------------------
  83          void DAC_Init()
  84          {
  85   1          REF0CN = 0x03; //; VREF ON
  86   1          DAC0CN    = 0x84; //; DAC0 validé - 12 bits à gauche - Update: write to DAC
  87   1          DAC1CN    = 0x84; //; DAC1 validé - 12 bits à gauche - Update: write to DAC
  88   1      }
  89          //-----------------------------------------------------------------------------
  90          // Envoi d'une valeur 12 bits dans le DAC0
  91          //-----------------------------------------------------------------------------
  92          void send_to_DAC0(unsigned int rampe)
  93          {
  94   1          rampe = (rampe<<4);
  95   1          DAC0L = rampe % 256;
  96   1          DAC0H = rampe / 256;   
  97   1      }
  98          //-----------------------------------------------------------------------------
  99          // Initialisation globale du Microcontrôleur - 
 100          //Description: Initialisations de périphériques
 101          //              Fonctionnalités Microcontroleur
 102          //              Configuration accès mémoire sur P4,5,6 et 7
 103          //             Acces en mode multiplexé.
 104          //             Sorties en Push-Pull sauf pour P4 en Drain ouvert
 105          //             Config SYSCLK:  Quartz externe
 106          //-----------------------------------------------------------------------------
 107          void Init_Device(void)
 108          {
 109   1          Reset_Sources_Init();
 110   1          Oscillator_Init();
 111   1          Port_IO_Init();
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    165    ----
C51 COMPILER V9.60.0.0   TP1_LIB_C                                                         02/09/2026 11:22:26 PAGE 3   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
